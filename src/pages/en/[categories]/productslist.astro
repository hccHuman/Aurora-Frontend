---
import Layout from "@/layouts/Layout.astro";
import { fetchCategories } from "@/services/categoryService";
import CategoryProductsListComponent from "@/components/tsx/Paginator/CategoryProductsListComponent";
import { t } from "@/modules/YOLI/injector";

// âš¡ getStaticPaths runs at build time
export async function getStaticPaths() {
  const categories: any[] = await fetchCategories();

  return categories.map((cat: any) => ({
    params: { categories: cat.nombre.toLowerCase().replace(/\s+/g, "-") },
  }));
}

// Dynamic URL parameter
const { categories } = Astro.params;

// Fetch all categories to get the ID
const allCategories: any[] = await fetchCategories();
const currentCategory = allCategories.find(
  (cat: any) => cat.nombre.toLowerCase().replace(/\s+/g, "-") === categories
);

const lang = "en";

if (!currentCategory) throw new Error(t("products.category_not_found", lang));

const id = currentCategory.id;

// We'll render products client-side and paginate using CategoryProductsListComponent
---

<Layout
  lang={lang}
  title={`${t("products.list_title", lang)} ${currentCategory.nombre}`}
  metaTitle={`${t("products.list_title", lang)} ${currentCategory.nombre}`}
  description={`${t("products.list_description", lang)} ${currentCategory.nombre}`}
  metaDescription={`${t("products.list_description", lang)} ${currentCategory.nombre}`}
  canonicalUrl={`https://lahia.shop/${lang}/${categories}`}
  previewImage="https://lahia.shop/assets/preview.png"
  home={true}
  showSearch={true}
  searchCategoryId={id}
  about={false}
  showSearch={false}
>
  <div class="flex-1 w-full flex flex-col">
    <h1 class="text-3xl font-bold mb-4 mt-6 flex justify-center" aria-live="polite">
      {t("products.list_title", lang)}
      {currentCategory.nombre}
    </h1>

    <CategoryProductsListComponent client:load categoryId={id} lang={lang} />
  </div>

  <!-- ProductModalWrapper mounted in layout globally -->
  <!-- ProductModalWrapper mounted in layout globally -->
</Layout>
