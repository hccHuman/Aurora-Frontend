---
import LoginReader from "@/components/tsx/statement/loginReader";

// src/pages/index.astro
---
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Redirecting...</title>
    <script type="module">
      async function redirectByLang() {
        try {
          // 1️⃣ Detectamos el idioma del navegador
          const userLang = navigator.language || navigator.userLanguage;
          const shortLang = userLang.slice(0, 2); // ej. "es-ES" -> "es"

          // 2️⃣ Traemos el JSON desde public
          const res = await fetch("/assets/langs.json");
          if (!res.ok) throw new Error("No se pudo cargar langs.json");
          const langMap = await res.json();

          // 3️⃣ Redirigimos según el idioma, si no existe, fallback a inglés
          const redirectUrl = langMap[shortLang] || langMap["en"];
          window.location.replace(redirectUrl);
        } catch (err) {
          console.error("Error al redirigir por idioma:", err);
          // Fallback manual
          window.location.replace("/");
        }
      }

      redirectByLang();
    </script>
  </head>
  <body>
    <LoginReader client:load />
    <p>Redirigiendo...</p>
  </body>
</html>
