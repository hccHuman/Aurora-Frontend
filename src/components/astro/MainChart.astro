---
import initMainChart from './MainChart.client';
import { fetchData } from '../../lib/data';

// Client-only initialization (avoid importing `astro/client` which resolves to types in some environments)
;(async () => {
  if (typeof window === 'undefined') return;

  const el = document.getElementById('main-chart') as HTMLElement | null;
  if (!el) return;

  // initial render with placeholder data
  const chartController = initMainChart(el, {
    series: [{ name: 'Revenue', data: [0, 0, 0, 0, 0, 0, 0] }],
    categories: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
  });

  // Fetch series from API
  try {
    const sales = await fetchData('sales');
    chartController.update(sales.series, sales.categories);
  } catch (e) {
    // keep initial data on error
    // eslint-disable-next-line no-console
    console.error(e);
  }
})();
---

<div class="w-full h-80" id="main-chart"></div>
